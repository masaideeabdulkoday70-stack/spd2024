<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{font-family:sans-serif;background:#f6f7fb;padding:30px}
.card{background:white;padding:20px;border-radius:15px}
</style>

</head>

<body>

<div class="card">

<h3>Dashboard ศพด.จะแนะ</h3>

<div class="row">

<div class="col">
<h5>บุคลากร</h5>
<h2 id="stat-total-staff">0</h2>
</div>

<div class="col">
<h5>ลากิจ</h5>
<h2 id="stat-kij">0</h2>
</div>

<div class="col">
<h5>ลาป่วย</h5>
<h2 id="stat-puay">0</h2>
</div>

</div>

<canvas id="leaveChart"></canvas>

</div>

<script>

// ⭐ ใส่ exec URL
const API_URL="https://script.google.com/macros/s/AKfycbwV_p2Rb9BBYu_xjkRaheHdCozdtkVwtxvBFQ-P7tSe-oF2emAX1IxiUehJFixXp0Wj/exec";

let db={};

fetch(API_URL)
.then(res=>res.json())
.then(data=>{
db=data;
updateDashboard();
})
.catch(err=>{
alert("โหลดข้อมูลไม่ได้ ตรวจสอบ Apps Script Anyone");
console.log(err);
});

function updateDashboard(){

let k=0,p=0;

db.leaves.forEach(l=>{

if(l.type.includes('กิจ')) k+=l.days;
if(l.type.includes('ป่วย')) p+=l.days;

});

document.getElementById('stat-total-staff').innerText=db.staff.length;
document.getElementById('stat-kij').innerText=k;
document.getElementById('stat-puay').innerText=p;

new Chart(document.getElementById('leaveChart'),{

type:'doughnut',

data:{
labels:['ลากิจ','ลาป่วย'],
datasets:[{
data:[k,p]
}]
}

});

}

</script>

</body>
</html>
